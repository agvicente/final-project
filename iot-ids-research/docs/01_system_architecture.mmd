%% ========================================
%% Diagrama 1: Arquitetura Geral do Sistema IDS para IoT
%% Formato: Mermaid
%% Como editar: https://mermaid.live ou VS Code com extensÃ£o Mermaid
%% Como exportar: PNG/SVG de alta qualidade para artigos
%% ========================================

graph TB
    subgraph "Data Layer"
        RAW[("ğŸ“¦ Raw Data<br/>CICIoT2023<br/>CSV Files")]
        PROCESSED[("ğŸ’¾ Processed Data<br/>Train/Test Split<br/>Normalized")]
    end
    
    subgraph "Preprocessing Pipeline"
        QUALITY["ğŸ” Quality Check<br/>dvc_run_quality_check.py<br/>ValidaÃ§Ã£o de dataset"]
        SAMPLING["ğŸ“Š Sampling<br/>dvc_sampling.py<br/>Balanceamento estratificado"]
        EDA["ğŸ“ˆ EDA<br/>src/eda/dvc_eda.py<br/>AnÃ¡lise exploratÃ³ria"]
        PREPROC["âš™ï¸ Preprocessing<br/>dvc_preprocessing.py<br/>Split & Normalization"]
        
        RAW --> QUALITY
        QUALITY --> SAMPLING
        SAMPLING --> EDA
        EDA --> PREPROC
        PREPROC --> PROCESSED
    end
    
    subgraph "ML Experimentation Layer"
        direction TB
        CONFIG["ğŸ“‹ Configuration<br/>configs/experiment_config.yaml"]
        
        subgraph "Algorithms"
            direction LR
            SUPERVISED["ğŸ‘¨â€ğŸ« Supervised Learning<br/>- Logistic Regression<br/>- Random Forest<br/>- Gradient Boosting<br/>- Linear SVC<br/>- SGD Classifier<br/>- MLP"]
            ANOMALY["ğŸš¨ Anomaly Detection<br/>- Isolation Forest<br/>- Local Outlier Factor<br/>- Elliptic Envelope<br/>- SGD One-Class SVM"]
        end
        
        RUNNER["ğŸƒ Runner<br/>run_single_algorithm.py"]
        METRICS["ğŸ“ Metrics Collector<br/>enhanced_metrics_collector.py<br/>CPU, Memory, Time"]
        
        CONFIG --> RUNNER
        PROCESSED --> RUNNER
        RUNNER --> SUPERVISED
        RUNNER --> ANOMALY
        SUPERVISED --> METRICS
        ANOMALY --> METRICS
    end
    
    subgraph "Analysis & Results Layer"
        INDIVIDUAL["ğŸ“Š Individual Analysis<br/>individual_analysis.py<br/>Per-algorithm insights"]
        CONSOLIDATE["ğŸ”— Consolidation<br/>consolidate_results.py<br/>Cross-algorithm comparison"]
        PLOTS["ğŸ“ˆ Advanced Plots<br/>iot_advanced_plots.py<br/>Visualizations"]
        
        METRICS --> INDIVIDUAL
        INDIVIDUAL --> CONSOLIDATE
        CONSOLIDATE --> PLOTS
    end
    
    subgraph "Output & Tracking"
        MLFLOW[("ğŸ—‚ï¸ MLflow<br/>Experiment Tracking<br/>mlruns/")]
        RESULTS[("ğŸ“ Results<br/>test/ & full/<br/>JSON + Plots")]
        MODELS[("ğŸ¤– Models<br/>Trained artifacts<br/>.pkl files")]
        
        METRICS --> MLFLOW
        INDIVIDUAL --> RESULTS
        CONSOLIDATE --> RESULTS
        RUNNER --> MODELS
    end
    
    subgraph "Orchestration"
        DVC["ğŸ”§ DVC Pipeline<br/>dvc.yaml<br/>Reproducible workflow"]
        
        DVC -.-> QUALITY
        DVC -.-> SAMPLING
        DVC -.-> EDA
        DVC -.-> PREPROC
        DVC -.-> RUNNER
        DVC -.-> CONSOLIDATE
    end
    
    style RAW fill:#e1f5ff
    style PROCESSED fill:#e1f5ff
    style MLFLOW fill:#fff9e1
    style RESULTS fill:#fff9e1
    style MODELS fill:#fff9e1
    style DVC fill:#e8f5e9
    style SUPERVISED fill:#ffebee
    style ANOMALY fill:#fce4ec

