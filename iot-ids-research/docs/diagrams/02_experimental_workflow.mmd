%% ========================================
%% Diagrama 2: Workflow Detalhado dos Experimentos
%% Formato: Mermaid (Flowchart)
%% Mostra o fluxo sequencial de execuÃ§Ã£o dos experimentos
%% ========================================

flowchart TD
    START([ğŸš€ InÃ­cio do Experimento])
    
    %% ConfiguraÃ§Ã£o Inicial
    INIT["âš™ï¸ InicializaÃ§Ã£o<br/>- Setup logging<br/>- Criar execution_id<br/>- Verificar TEST_MODE"]
    CONFIG_LOAD["ğŸ“‹ Carregar ConfiguraÃ§Ã£o<br/>- experiment_config.yaml<br/>- Definir hiperparÃ¢metros<br/>- EstratÃ©gia adaptativa"]
    
    %% Carregamento de Dados
    LOAD_DATA["ğŸ“¥ Carregar Dados<br/>- X_train_binary.npy<br/>- X_test_binary.npy<br/>- y_train/y_test<br/>- metadata.json"]
    VERIFY_DATA{"âœ… Dados vÃ¡lidos?<br/>Shape correto?<br/>Labels balanceados?"}
    
    %% Sampling Opcional
    SAMPLE_CHECK{"ğŸ”€ TEST_MODE?<br/>Sample = 1000?"}
    SAMPLE_DATA["ğŸ“Š Sampling<br/>Reduzir dataset<br/>para 1000 amostras"]
    
    %% Loop Principal de Algoritmos
    SELECT_ALGO["ğŸ¯ Selecionar Algoritmo<br/>Por complexidade:<br/>O(n) â†’ O(nÂ²)"]
    
    %% Loop de ExecuÃ§Ãµes
    EXECUTION_LOOP{"ğŸ”„ Loop de ExecuÃ§Ãµes<br/>N_RUNS vezes"}
    
    subgraph "Training & Evaluation"
        direction TB
        RESOURCE_START["ğŸ“Š Snapshot Inicial<br/>CPU, Memory baseline"]
        
        TRAIN["ğŸ‹ï¸ Treinamento<br/>- fit() no train set<br/>- Monitorar tempo<br/>- Medir recursos"]
        
        PREDICT["ğŸ”® PrediÃ§Ã£o<br/>- predict() no test set<br/>- Calcular latÃªncia<br/>- Throughput"]
        
        CALC_METRICS["ğŸ“ Calcular MÃ©tricas<br/>- Accuracy, Precision<br/>- Recall, F1, Balanced Accuracy<br/>- ROC-AUC, Confusion Matrix"]
        
        RESOURCE_END["ğŸ“Š Snapshot Final<br/>Delta de recursos<br/>Peak memory"]
        
        RESOURCE_START --> TRAIN
        TRAIN --> PREDICT
        PREDICT --> CALC_METRICS
        CALC_METRICS --> RESOURCE_END
    end
    
    %% Salvamento
    SAVE_RUN["ğŸ’¾ Salvar ExecuÃ§Ã£o<br/>- results.json<br/>- params & metrics<br/>- MLflow tracking"]
    
    %% DecisÃµes de Loop
    MORE_RUNS{"â• Mais execuÃ§Ãµes?<br/>run < N_RUNS"}
    MORE_ALGOS{"ğŸ” Mais algoritmos?<br/>Na fila de execuÃ§Ã£o"}
    
    %% AnÃ¡lise Individual
    INDIVIDUAL_ANALYSIS["ğŸ“Š AnÃ¡lise Individual<br/>- Agregar por param_id<br/>- MÃ©dia & Std Dev<br/>- Plots especÃ­ficos<br/>- Summary report"]
    
    %% ConsolidaÃ§Ã£o Final
    CONSOLIDATE["ğŸ”— Consolidar Resultados<br/>- Comparar todos algoritmos<br/>- Rankings<br/>- Pareto frontier<br/>- Advanced plots"]
    
    %% Fim
    FINISH([âœ… Experimento Completo])
    ERROR([âŒ Erro])
    
    %% Fluxo Principal
    START --> INIT
    INIT --> CONFIG_LOAD
    CONFIG_LOAD --> LOAD_DATA
    LOAD_DATA --> VERIFY_DATA
    
    VERIFY_DATA -->|Sim| SAMPLE_CHECK
    VERIFY_DATA -->|NÃ£o| ERROR
    
    SAMPLE_CHECK -->|Sim| SAMPLE_DATA
    SAMPLE_CHECK -->|NÃ£o| SELECT_ALGO
    SAMPLE_DATA --> SELECT_ALGO
    
    SELECT_ALGO --> EXECUTION_LOOP
    EXECUTION_LOOP -->|Iniciar run| RESOURCE_START
    
    RESOURCE_END --> SAVE_RUN
    SAVE_RUN --> MORE_RUNS
    
    MORE_RUNS -->|Sim| EXECUTION_LOOP
    MORE_RUNS -->|NÃ£o| INDIVIDUAL_ANALYSIS
    
    INDIVIDUAL_ANALYSIS --> MORE_ALGOS
    MORE_ALGOS -->|Sim| SELECT_ALGO
    MORE_ALGOS -->|NÃ£o| CONSOLIDATE
    
    CONSOLIDATE --> FINISH
    
    %% Styling
    style START fill:#c8e6c9
    style FINISH fill:#c8e6c9
    style ERROR fill:#ffcdd2
    style TRAIN fill:#bbdefb
    style PREDICT fill:#bbdefb
    style CALC_METRICS fill:#fff9c4
    style CONSOLIDATE fill:#f8bbd0

